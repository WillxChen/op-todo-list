(()=>{"use strict";const e=(e,t=crypto.randomUUID().slice(0,8))=>{const a=[],n=(e=>{const t=t=>e.findIndex((e=>e.id===t));return{getTaskById:t=>e.find((e=>e.id===t)),createTask:t=>(e.push({id:crypto.randomUUID().slice(0,8),title:t}),e[e.length-1]),updateTask:(a,n)=>{const s=t(a);e[s]={...e[s],...n}},removeTask:a=>{const n=t(a);e.splice(n,1)}}})(a);return{getTitle:()=>e,getId:()=>t,getTasks:()=>a,createTask:e=>n.createTask(e),getTaskById:e=>n.getTaskById(e),updateTask:(e,t)=>n.updateTask(e,t),removeTask:e=>n.removeTask(e)}},{appendCustomElement:t,createCustomElement:a}=(()=>{function e(e){const{tagName:t,classList:a,textContent:n,attributes:s}=e,r=document.createElement(t);if("string"==typeof a?r.classList.add(a):Array.isArray(a)&&r.classList.add(...a),n&&(r.textContent=n),Array.isArray(s)){const[e,t]=s;r.setAttribute(e,t)}return r}return{appendCustomElement:function(t){const{target:a}=t,n=document.querySelector(a),s=e(t);n.appendChild(s)},createCustomElement:e}})(),{createTaskElements:n,renderTaskElements:s,renderExpandedTask:r}={createTaskElements:(e,t)=>e.map((e=>{const a=document.createElement("div");a.className="task",a.dataset.id=e.id;const n=document.createElement("p");return n.textContent=e.title,a.appendChild(n),a.addEventListener("dblclick",(a=>{o(a,e.id,t)})),a.addEventListener("click",(t=>{l(t,e)})),a})),renderTaskElements:(e,t)=>{e.prepend(...t)},renderExpandedTask:(e,t)=>{const n=(e=>{const{description:t,dueDate:n,difficulty:s}=e,r=document.createDocumentFragment(),d=document.createElement("div");return d.classList.add("expanded-details"),r.append(d),d.append(a({target:d,tagName:"p",classList:"description",textContent:"description"})),d.append(a({target:d,tagName:"p",classList:"due-date",textContent:"dueDate"})),d.append(a({target:d,tagName:"p",classList:"difficulty",textContent:"difficulty"})),r})(t);return e.append(n),n}},{renderListElements:d}={renderListElements:e=>{e.forEach((e=>{const r=e.getId();(e=>{t({target:".list-container",tagName:"div",classList:["list"],attributes:["data-id",e]})})(r),((e,n)=>{const s=document.querySelector(`[data-id="${n}"]`);t({target:`[data-id="${n}"]`,tagName:"h2",textContent:e.getTitle()}),s.appendChild(((e,t)=>{const n=document.createElement("form");n.className="task-form";const s=a({tagName:"input",classList:"task-input",attributes:["placeholder","Add a task"]});return n.appendChild(s),s.addEventListener("keydown",(a=>{c(a,e,t)})),n})(s,e))})(e,r),(e=>{t({target:`[data-id="${e}"]`,tagName:"div",classList:"task-container"})})(r),((e,t)=>{const a=document.querySelector(`[data-id="${t}"]`).querySelector(".task-container"),r=n(e.getTasks(),e);s(a,r)})(e,r)}))}},{handleCreateListInput:i,handleCreateTaskInput:c,editTask:o,toggleDetails:l}={handleCreateListInput:(e,t)=>{if("Enter"===e.key){e.preventDefault();const a=e.target.value,n=t.createList(a);d([n]),e.target.value=""}},handleCreateTaskInput:(e,t,a)=>{if("Enter"===e.key){e.preventDefault();const r=e.target.value,d=a.createTask(r),i=n([d],a);s(t.querySelector(".task-container"),i),e.target.value=""}},editTask:(e,t,a)=>{const n=e.target,s=n.cloneNode(!0),r=document.createElement("input"),d=a.getTaskById(t);r.value=d.title,n.replaceWith(r),r.addEventListener("keydown",(e=>{"Enter"===e.key&&r.blur()})),r.addEventListener("blur",(()=>{a.updateTask(t,{title:r.value}),s.textContent=r.value,r.replaceWith(s)}),{once:!0}),r.focus()},toggleDetails:(e,t)=>{const a=e.target.closest(".task"),n=a.querySelector(".expanded-details");a.classList.toggle("expanded"),n?n.remove():r(a,t)}},{checkForLists:u}={checkForLists:e=>{const t=e.getLists();t.length?d(t):((e=>{e.createList("Habits").createTask("Create your first task!")})(e),d(e.getLists()))}},p=(()=>{const t=[];return{getLists:()=>t,createList:a=>(t.push(e(a)),t[t.length-1]),findList:e=>{const a=t.findIndex((t=>t.id===e));return t[a]}}})();(()=>{const e=document.querySelector("#list-input");return{init:()=>{u(p),e.addEventListener("keydown",(e=>{i(e,p)}))}}})().init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RURacEIsR0FFRCxNQUNwQixNQUFNZixFQUFRL0QsU0FBU1UsY0FBYyxlQVVyQyxNQUFPLENBQUVxRSxLQVJJLEtBQ1hOLEVBQWNwQixHQUVkVSxFQUFNekMsaUJBQWlCLFdBQVlDLElBQ2pDNkIsRUFBc0I3QixFQUFHOEIsRUFBZSxHQUN4QyxFQUlMLEVBWnFCLEdFRG5CMEIsTSIsInNvdXJjZXMiOlsid2VicGFjazovL29wLXRvZG8tbGlzdC8uL3NyYy9tb2R1bGVzL1Rhc2tNYW5hZ2VyLmpzIiwid2VicGFjazovL29wLXRvZG8tbGlzdC8uL3NyYy9tb2R1bGVzL0xpc3QuanMiLCJ3ZWJwYWNrOi8vb3AtdG9kby1saXN0Ly4vc3JjL21vZHVsZXMvY3VzdG9tRWxlbWVudEhlbHBlci5qcyIsIndlYnBhY2s6Ly9vcC10b2RvLWxpc3QvLi9zcmMvbW9kdWxlcy9UYXNrUmVuZGVyZXIuanMiLCJ3ZWJwYWNrOi8vb3AtdG9kby1saXN0Ly4vc3JjL21vZHVsZXMvTGlzdFJlbmRlcmVyLmpzIiwid2VicGFjazovL29wLXRvZG8tbGlzdC8uL3NyYy9tb2R1bGVzL0V2ZW50SGFuZGxlci5qcyIsIndlYnBhY2s6Ly9vcC10b2RvLWxpc3QvLi9zcmMvbW9kdWxlcy9MaXN0SGFuZGxlci5qcyIsIndlYnBhY2s6Ly9vcC10b2RvLWxpc3QvLi9zcmMvbW9kdWxlcy9Vc2VySW50ZXJmYWNlLmpzIiwid2VicGFjazovL29wLXRvZG8tbGlzdC8uL3NyYy9tb2R1bGVzL1Byb2plY3QuanMiLCJ3ZWJwYWNrOi8vb3AtdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFRhc2tNYW5hZ2VyID0gKHRhc2tMaXN0KSA9PiB7XHJcbiAgY29uc3QgZ2V0VGFza0J5SWQgPSAodGFza0lkKSA9PiB7XHJcbiAgICByZXR1cm4gdGFza0xpc3QuZmluZCgodGFzaykgPT4gdGFzay5pZCA9PT0gdGFza0lkKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBnZXRUYXNrQnlJbmRleCA9ICh0YXNrSWQpID0+IHtcclxuICAgIHJldHVybiB0YXNrTGlzdC5maW5kSW5kZXgoKHRhc2spID0+IHRhc2suaWQgPT09IHRhc2tJZCk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgY3JlYXRlVGFzayA9ICh0aXRsZSkgPT4ge1xyXG4gICAgdGFza0xpc3QucHVzaCh7XHJcbiAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLnNsaWNlKDAsIDgpLFxyXG4gICAgICB0aXRsZSxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRhc2tMaXN0W3Rhc2tMaXN0Lmxlbmd0aCAtIDFdO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHVwZGF0ZVRhc2sgPSAodGFza0lkLCB1cGRhdGVkRW50cnkpID0+IHtcclxuICAgIGNvbnN0IHRhc2tJbmRleCA9IGdldFRhc2tCeUluZGV4KHRhc2tJZCk7XHJcbiAgICB0YXNrTGlzdFt0YXNrSW5kZXhdID0geyAuLi50YXNrTGlzdFt0YXNrSW5kZXhdLCAuLi51cGRhdGVkRW50cnkgfTtcclxuICB9O1xyXG5cclxuICBjb25zdCByZW1vdmVUYXNrID0gKHRhc2tJZCkgPT4ge1xyXG4gICAgY29uc3QgdGFza0luZGV4ID0gZ2V0VGFza0J5SW5kZXgodGFza0lkKTtcclxuICAgIHRhc2tMaXN0LnNwbGljZSh0YXNrSW5kZXgsIDEpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7IGdldFRhc2tCeUlkLCBjcmVhdGVUYXNrLCB1cGRhdGVUYXNrLCByZW1vdmVUYXNrIH07XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBUYXNrTWFuYWdlcjtcclxuIiwiaW1wb3J0IFRhc2tNYW5hZ2VyIGZyb20gXCIuL1Rhc2tNYW5hZ2VyXCI7XHJcblxyXG5jb25zdCBMaXN0ID0gKHRpdGxlLCBpZCA9IGNyeXB0by5yYW5kb21VVUlEKCkuc2xpY2UoMCwgOCkpID0+IHtcclxuICBjb25zdCB0YXNrcyA9IFtdO1xyXG4gIGNvbnN0IHRhc2tNYW5hZ2VyID0gVGFza01hbmFnZXIodGFza3MpO1xyXG5cclxuICBjb25zdCBnZXRUaXRsZSA9ICgpID0+IHRpdGxlO1xyXG4gIGNvbnN0IGdldElkID0gKCkgPT4gaWQ7XHJcbiAgY29uc3QgZ2V0VGFza3MgPSAoKSA9PiB0YXNrcztcclxuXHJcbiAgY29uc3QgY3JlYXRlVGFzayA9ICh0aXRsZSkgPT4ge1xyXG4gICAgcmV0dXJuIHRhc2tNYW5hZ2VyLmNyZWF0ZVRhc2sodGl0bGUpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGdldFRhc2tCeUlkID0gKHRhc2tJZCkgPT4ge1xyXG4gICAgcmV0dXJuIHRhc2tNYW5hZ2VyLmdldFRhc2tCeUlkKHRhc2tJZCk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgdXBkYXRlVGFzayA9ICh0YXNrSWQsIHVwZGF0ZWRFbnRyeSkgPT4ge1xyXG4gICAgcmV0dXJuIHRhc2tNYW5hZ2VyLnVwZGF0ZVRhc2sodGFza0lkLCB1cGRhdGVkRW50cnkpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJlbW92ZVRhc2sgPSAodGFza0lkKSA9PiB7XHJcbiAgICByZXR1cm4gdGFza01hbmFnZXIucmVtb3ZlVGFzayh0YXNrSWQpO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBnZXRUaXRsZSxcclxuICAgIGdldElkLFxyXG4gICAgZ2V0VGFza3MsXHJcbiAgICBjcmVhdGVUYXNrLFxyXG4gICAgZ2V0VGFza0J5SWQsXHJcbiAgICB1cGRhdGVUYXNrLFxyXG4gICAgcmVtb3ZlVGFzayxcclxuICB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgTGlzdDtcclxuIiwiY29uc3QgY3VzdG9tRWxlbWVudEhlbHBlciA9ICgpID0+IHtcclxuICBmdW5jdGlvbiBhcHBlbmRDdXN0b21FbGVtZW50KG9wdGlvbnMpIHtcclxuICAgIGNvbnN0IHsgdGFyZ2V0IH0gPSBvcHRpb25zO1xyXG4gICAgY29uc3QgdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGFyZ2V0KTtcclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gY3JlYXRlQ3VzdG9tRWxlbWVudChvcHRpb25zKTtcclxuICAgIHRhcmdldEVsZW1lbnQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVDdXN0b21FbGVtZW50KG9wdGlvbnMpIHtcclxuICAgIGNvbnN0IHsgdGFnTmFtZSwgY2xhc3NMaXN0LCB0ZXh0Q29udGVudCwgYXR0cmlidXRlcyB9ID0gb3B0aW9ucztcclxuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpO1xyXG5cclxuICAgIGlmICh0eXBlb2YgY2xhc3NMaXN0ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc0xpc3QpO1xyXG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGNsYXNzTGlzdCkpIHtcclxuICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKC4uLmNsYXNzTGlzdCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGV4dENvbnRlbnQpIHtcclxuICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IHRleHRDb250ZW50O1xyXG4gICAgfVxyXG4gICAgaWYgKEFycmF5LmlzQXJyYXkoYXR0cmlidXRlcykpIHtcclxuICAgICAgY29uc3QgW2F0dHIsIHZhbHVlXSA9IGF0dHJpYnV0ZXM7XHJcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKGF0dHIsIHZhbHVlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBlbGVtZW50O1xyXG4gIH1cclxuICByZXR1cm4geyBhcHBlbmRDdXN0b21FbGVtZW50LCBjcmVhdGVDdXN0b21FbGVtZW50IH07XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgeyBhcHBlbmRDdXN0b21FbGVtZW50LCBjcmVhdGVDdXN0b21FbGVtZW50IH0gPVxyXG4gIGN1c3RvbUVsZW1lbnRIZWxwZXIoKTtcclxuIiwiaW1wb3J0IHsgZWRpdFRhc2ssIHRvZ2dsZURldGFpbHMgfSBmcm9tIFwiLi9FdmVudEhhbmRsZXIuanNcIjtcclxuaW1wb3J0IHsgY3JlYXRlQ3VzdG9tRWxlbWVudCB9IGZyb20gXCIuL2N1c3RvbUVsZW1lbnRIZWxwZXIuanNcIjtcclxuXHJcbmNvbnN0IFRhc2tSZW5kZXJlciA9ICgpID0+IHtcclxuICBjb25zdCByZW5kZXJUYXNrRWxlbWVudHMgPSAodGFyZ2V0LCB0YXNrcykgPT4ge1xyXG4gICAgdGFyZ2V0LnByZXBlbmQoLi4udGFza3MpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNyZWF0ZVRhc2tFbGVtZW50cyA9ICh0YXNrcywgY3VycmVudExpc3QpID0+IHtcclxuICAgIHJldHVybiB0YXNrcy5tYXAoKHRhc2spID0+IHtcclxuICAgICAgLy8gRGl2IGNvbnRhaW5lclxyXG4gICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBkaXYuY2xhc3NOYW1lID0gXCJ0YXNrXCI7XHJcbiAgICAgIGRpdi5kYXRhc2V0LmlkID0gdGFzay5pZDtcclxuXHJcbiAgICAgIC8vIFBhcmFncmFwaCBlbGVtZW50XHJcbiAgICAgIGNvbnN0IHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgICAgcC50ZXh0Q29udGVudCA9IHRhc2sudGl0bGU7XHJcbiAgICAgIGRpdi5hcHBlbmRDaGlsZChwKTtcclxuXHJcbiAgICAgIC8vIEFkZCBvbmNsaWNrIHRvIGNoYW5nZSBlbGVtZW50IHRvIGlucHV0IG9uIGNsaWNrXHJcbiAgICAgIGRpdi5hZGRFdmVudExpc3RlbmVyKFwiZGJsY2xpY2tcIiwgKGUpID0+IHtcclxuICAgICAgICBlZGl0VGFzayhlLCB0YXNrLmlkLCBjdXJyZW50TGlzdCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gICAgICAgIHRvZ2dsZURldGFpbHMoZSwgdGFzayk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIGRpdjtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJlbmRlckV4cGFuZGVkVGFzayA9ICh0YXJnZXQsIHRhc2spID0+IHtcclxuICAgIGNvbnN0IGV4cGFuZGVkVGFzayA9IF9fY3JlYXRlRXhwYW5kZWRUYXNrKHRhc2spO1xyXG4gICAgdGFyZ2V0LmFwcGVuZChleHBhbmRlZFRhc2spO1xyXG4gICAgcmV0dXJuIGV4cGFuZGVkVGFzaztcclxuICB9O1xyXG5cclxuICBjb25zdCBfX2NyZWF0ZUV4cGFuZGVkVGFzayA9ICh0YXNrKSA9PiB7XHJcbiAgICBjb25zdCB7IGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBkaWZmaWN1bHR5IH0gPSB0YXNrO1xyXG5cclxuICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xyXG4gICAgLy8gQXBwZW5kIGNoaWxkcmVuIHRvIGZyYWdtZW50XHJcbiAgICBjb25zdCBleHBhbmRlZERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAvLyBTZXQgdG9nZ2xlIGF0dHJpYnV0ZSB0byB3b3JrIHdpdGggdG9nZ2xlIGV2ZW50IGxpc3RlbmVyXHJcbiAgICBleHBhbmRlZERpdi5jbGFzc0xpc3QuYWRkKFwiZXhwYW5kZWQtZGV0YWlsc1wiKTtcclxuICAgIGZyYWdtZW50LmFwcGVuZChleHBhbmRlZERpdik7XHJcblxyXG4gICAgLy8gZGVzY3JpcHRpb24gJiZcclxuICAgIGV4cGFuZGVkRGl2LmFwcGVuZChcclxuICAgICAgY3JlYXRlQ3VzdG9tRWxlbWVudCh7XHJcbiAgICAgICAgdGFyZ2V0OiBleHBhbmRlZERpdixcclxuICAgICAgICB0YWdOYW1lOiBcInBcIixcclxuICAgICAgICBjbGFzc0xpc3Q6IFwiZGVzY3JpcHRpb25cIixcclxuICAgICAgICB0ZXh0Q29udGVudDogXCJkZXNjcmlwdGlvblwiLFxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBkdWVEYXRlICYmXHJcbiAgICBleHBhbmRlZERpdi5hcHBlbmQoXHJcbiAgICAgIGNyZWF0ZUN1c3RvbUVsZW1lbnQoe1xyXG4gICAgICAgIHRhcmdldDogZXhwYW5kZWREaXYsXHJcbiAgICAgICAgdGFnTmFtZTogXCJwXCIsXHJcbiAgICAgICAgY2xhc3NMaXN0OiBcImR1ZS1kYXRlXCIsXHJcbiAgICAgICAgdGV4dENvbnRlbnQ6IFwiZHVlRGF0ZVwiLFxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBkaWZmaWN1bHR5ICYmXHJcbiAgICBleHBhbmRlZERpdi5hcHBlbmQoXHJcbiAgICAgIGNyZWF0ZUN1c3RvbUVsZW1lbnQoe1xyXG4gICAgICAgIHRhcmdldDogZXhwYW5kZWREaXYsXHJcbiAgICAgICAgdGFnTmFtZTogXCJwXCIsXHJcbiAgICAgICAgY2xhc3NMaXN0OiBcImRpZmZpY3VsdHlcIixcclxuICAgICAgICB0ZXh0Q29udGVudDogXCJkaWZmaWN1bHR5XCIsXHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHJldHVybiBmcmFnbWVudDtcclxuICB9O1xyXG5cclxuICByZXR1cm4geyBjcmVhdGVUYXNrRWxlbWVudHMsIHJlbmRlclRhc2tFbGVtZW50cywgcmVuZGVyRXhwYW5kZWRUYXNrIH07XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgeyBjcmVhdGVUYXNrRWxlbWVudHMsIHJlbmRlclRhc2tFbGVtZW50cywgcmVuZGVyRXhwYW5kZWRUYXNrIH0gPVxyXG4gIFRhc2tSZW5kZXJlcigpO1xyXG4iLCJpbXBvcnQge1xyXG4gIGFwcGVuZEN1c3RvbUVsZW1lbnQsXHJcbiAgY3JlYXRlQ3VzdG9tRWxlbWVudCxcclxufSBmcm9tIFwiLi9jdXN0b21FbGVtZW50SGVscGVyLmpzXCI7XHJcbmltcG9ydCB7IGNyZWF0ZVRhc2tFbGVtZW50cywgcmVuZGVyVGFza0VsZW1lbnRzIH0gZnJvbSBcIi4vVGFza1JlbmRlcmVyLmpzXCI7XHJcbmltcG9ydCB7IGhhbmRsZUNyZWF0ZVRhc2tJbnB1dCB9IGZyb20gXCIuL0V2ZW50SGFuZGxlci5qc1wiO1xyXG5cclxuY29uc3QgTGlzdFJlbmRlcmVyID0gKCkgPT4ge1xyXG4gIGNvbnN0IGNyZWF0ZVRhc2tGb3JtID0gKHRhcmdldCwgbGlzdCkgPT4ge1xyXG4gICAgLy8gQ3JlYXRlIGZvcm0gYW5kIGFwcGVuZCBpbnB1dCB0byBMaXN0XHJcbiAgICBjb25zdCB0YXNrRm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xyXG4gICAgdGFza0Zvcm0uY2xhc3NOYW1lID0gXCJ0YXNrLWZvcm1cIjtcclxuICAgIGNvbnN0IHRhc2tJbnB1dCA9IGNyZWF0ZUN1c3RvbUVsZW1lbnQoe1xyXG4gICAgICB0YWdOYW1lOiBcImlucHV0XCIsXHJcbiAgICAgIGNsYXNzTGlzdDogXCJ0YXNrLWlucHV0XCIsXHJcbiAgICAgIGF0dHJpYnV0ZXM6IFtcInBsYWNlaG9sZGVyXCIsIFwiQWRkIGEgdGFza1wiXSxcclxuICAgIH0pO1xyXG4gICAgdGFza0Zvcm0uYXBwZW5kQ2hpbGQodGFza0lucHV0KTtcclxuXHJcbiAgICAvLyBCaW5kIGlucHV0IGxpc3RlbmVyIHRvIG1vbml0b3IgbmV3IHRhc2sgZW50cmllc1xyXG4gICAgdGFza0lucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XHJcbiAgICAgIGhhbmRsZUNyZWF0ZVRhc2tJbnB1dChlLCB0YXJnZXQsIGxpc3QpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGFza0Zvcm07XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgYXBwZW5kTGlzdENvbnRhaW5lciA9IChsaXN0SWQpID0+IHtcclxuICAgIGFwcGVuZEN1c3RvbUVsZW1lbnQoe1xyXG4gICAgICB0YXJnZXQ6IFwiLmxpc3QtY29udGFpbmVyXCIsXHJcbiAgICAgIHRhZ05hbWU6IFwiZGl2XCIsXHJcbiAgICAgIGNsYXNzTGlzdDogW1wibGlzdFwiXSxcclxuICAgICAgYXR0cmlidXRlczogW1wiZGF0YS1pZFwiLCBsaXN0SWRdLFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgYXBwZW5kTGlzdEFuZFRpdGxlRWxlbWVudHMgPSAobGlzdCwgbGlzdElkKSA9PiB7XHJcbiAgICBjb25zdCBsaXN0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWlkPVwiJHtsaXN0SWR9XCJdYCk7XHJcbiAgICBhcHBlbmRDdXN0b21FbGVtZW50KHtcclxuICAgICAgdGFyZ2V0OiBgW2RhdGEtaWQ9XCIke2xpc3RJZH1cIl1gLFxyXG4gICAgICB0YWdOYW1lOiBcImgyXCIsXHJcbiAgICAgIHRleHRDb250ZW50OiBsaXN0LmdldFRpdGxlKCksXHJcbiAgICB9KTtcclxuXHJcbiAgICBsaXN0RWxlbWVudC5hcHBlbmRDaGlsZChjcmVhdGVUYXNrRm9ybShsaXN0RWxlbWVudCwgbGlzdCwgbGlzdElkKSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgYXBwZW5kVGFza0NvbnRhaW5lciA9IChsaXN0SWQpID0+IHtcclxuICAgIGFwcGVuZEN1c3RvbUVsZW1lbnQoe1xyXG4gICAgICB0YXJnZXQ6IGBbZGF0YS1pZD1cIiR7bGlzdElkfVwiXWAsXHJcbiAgICAgIHRhZ05hbWU6IFwiZGl2XCIsXHJcbiAgICAgIGNsYXNzTGlzdDogXCJ0YXNrLWNvbnRhaW5lclwiLFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgYXBwZW5kVGFza0VsZW1lbnRzID0gKGxpc3QsIGxpc3RJZCkgPT4ge1xyXG4gICAgY29uc3QgbGlzdEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1pZD1cIiR7bGlzdElkfVwiXWApO1xyXG4gICAgY29uc3QgdGFza0NvbnRhaW5lciA9IGxpc3RFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGFzay1jb250YWluZXJcIik7XHJcbiAgICBjb25zdCB0YXNrRWxlbWVudHMgPSBjcmVhdGVUYXNrRWxlbWVudHMobGlzdC5nZXRUYXNrcygpLCBsaXN0KTtcclxuICAgIHJlbmRlclRhc2tFbGVtZW50cyh0YXNrQ29udGFpbmVyLCB0YXNrRWxlbWVudHMpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHJlbmRlckxpc3RFbGVtZW50cyA9IChsaXN0cykgPT4ge1xyXG4gICAgbGlzdHMuZm9yRWFjaCgobGlzdCkgPT4ge1xyXG4gICAgICBjb25zdCBsaXN0SWQgPSBsaXN0LmdldElkKCk7XHJcblxyXG4gICAgICBhcHBlbmRMaXN0Q29udGFpbmVyKGxpc3RJZCk7XHJcbiAgICAgIGFwcGVuZExpc3RBbmRUaXRsZUVsZW1lbnRzKGxpc3QsIGxpc3RJZCk7XHJcbiAgICAgIGFwcGVuZFRhc2tDb250YWluZXIobGlzdElkKTtcclxuICAgICAgYXBwZW5kVGFza0VsZW1lbnRzKGxpc3QsIGxpc3RJZCk7XHJcblxyXG4gICAgICAvLyBOb3cgcmVuZGVyIGFuZCBhcHBlbmQgdGhlIHRhc2sgZWxlbWVudHNcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7IHJlbmRlckxpc3RFbGVtZW50cyB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHsgcmVuZGVyTGlzdEVsZW1lbnRzIH0gPSBMaXN0UmVuZGVyZXIoKTtcclxuIiwiaW1wb3J0IExpc3QgZnJvbSBcIi4vTGlzdC5qc1wiO1xyXG5pbXBvcnQgeyByZW5kZXJMaXN0RWxlbWVudHMgfSBmcm9tIFwiLi9MaXN0UmVuZGVyZXIuanNcIjtcclxuaW1wb3J0IHtcclxuICBjcmVhdGVUYXNrRWxlbWVudHMsXHJcbiAgcmVuZGVyVGFza0VsZW1lbnRzLFxyXG4gIHJlbmRlckV4cGFuZGVkVGFzayxcclxufSBmcm9tIFwiLi9UYXNrUmVuZGVyZXIuanNcIjtcclxuXHJcbmNvbnN0IEV2ZW50SGFuZGxlciA9ICgpID0+IHtcclxuICBjb25zdCBoYW5kbGVDcmVhdGVMaXN0SW5wdXQgPSAoZSwgY3VycmVudFByb2plY3QpID0+IHtcclxuICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgdGl0bGUgPSBlLnRhcmdldC52YWx1ZTtcclxuXHJcbiAgICAgIGNvbnN0IG5ld0xpc3QgPSBjdXJyZW50UHJvamVjdC5jcmVhdGVMaXN0KHRpdGxlKTtcclxuICAgICAgcmVuZGVyTGlzdEVsZW1lbnRzKFtuZXdMaXN0XSk7XHJcblxyXG4gICAgICBlLnRhcmdldC52YWx1ZSA9IFwiXCI7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlQ3JlYXRlVGFza0lucHV0ID0gKGUsIHRhcmdldCwgbGlzdCkgPT4ge1xyXG4gICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBjb25zdCB0aXRsZSA9IGUudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAvLyBDcmVhdGUgYSBuZXcgdGFzayBlbnRyeSBpbiBsaXN0IGFycmF5XHJcbiAgICAgIGNvbnN0IG5ld1Rhc2sgPSBsaXN0LmNyZWF0ZVRhc2sodGl0bGUpO1xyXG4gICAgICAvLyBDcmVhdGUgYW5kIHJlbmRlciB0YXNrIGVsZW1lbnRzXHJcbiAgICAgIGNvbnN0IHRhc2tFbGVtZW50ID0gY3JlYXRlVGFza0VsZW1lbnRzKFtuZXdUYXNrXSwgbGlzdCk7XHJcbiAgICAgIHJlbmRlclRhc2tFbGVtZW50cyh0YXJnZXQucXVlcnlTZWxlY3RvcihcIi50YXNrLWNvbnRhaW5lclwiKSwgdGFza0VsZW1lbnQpO1xyXG5cclxuICAgICAgZS50YXJnZXQudmFsdWUgPSBcIlwiO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGVkaXRUYXNrID0gKGUsIHRhc2tJZCwgY3VycmVudExpc3QpID0+IHtcclxuICAgIGNvbnN0IGVsID0gZS50YXJnZXQ7XHJcbiAgICBjb25zdCBwcmV2aW91cyA9IGVsLmNsb25lTm9kZSh0cnVlKTtcclxuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnRUYXNrID0gY3VycmVudExpc3QuZ2V0VGFza0J5SWQodGFza0lkKTtcclxuICAgIGlucHV0LnZhbHVlID0gY3VycmVudFRhc2sudGl0bGU7XHJcbiAgICBlbC5yZXBsYWNlV2l0aChpbnB1dCk7XHJcblxyXG4gICAgY29uc3Qgc2F2ZSA9ICgpID0+IHtcclxuICAgICAgLy8gU2F2ZSB0aGUgaW5wdXQgdmFsdWUgaW50byB0aGUgc2VsZWN0ZWQgdGFza1xyXG4gICAgICBjdXJyZW50TGlzdC51cGRhdGVUYXNrKHRhc2tJZCwgeyB0aXRsZTogaW5wdXQudmFsdWUgfSk7XHJcbiAgICAgIHByZXZpb3VzLnRleHRDb250ZW50ID0gaW5wdXQudmFsdWU7XHJcbiAgICAgIGlucHV0LnJlcGxhY2VXaXRoKHByZXZpb3VzKTtcclxuICAgIH07XHJcblxyXG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcclxuICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIpIHtcclxuICAgICAgICBpbnB1dC5ibHVyKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIHNhdmUsIHtcclxuICAgICAgb25jZTogdHJ1ZSxcclxuICAgIH0pO1xyXG4gICAgaW5wdXQuZm9jdXMoKTtcclxuICB9O1xyXG5cclxuICBjb25zdCB0b2dnbGVEZXRhaWxzID0gKGUsIHRhc2spID0+IHtcclxuICAgIGNvbnN0IHRhc2tDb250YWluZXIgPSBlLnRhcmdldC5jbG9zZXN0KFwiLnRhc2tcIik7XHJcbiAgICBjb25zdCBleHBhbmRlZERldGFpbHMgPSB0YXNrQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIuZXhwYW5kZWQtZGV0YWlsc1wiKTtcclxuICAgIHRhc2tDb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZShcImV4cGFuZGVkXCIpO1xyXG4gICAgaWYgKCFleHBhbmRlZERldGFpbHMpIHtcclxuICAgICAgcmVuZGVyRXhwYW5kZWRUYXNrKHRhc2tDb250YWluZXIsIHRhc2spO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZXhwYW5kZWREZXRhaWxzLnJlbW92ZSgpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBoYW5kbGVDcmVhdGVMaXN0SW5wdXQsXHJcbiAgICBoYW5kbGVDcmVhdGVUYXNrSW5wdXQsXHJcbiAgICBlZGl0VGFzayxcclxuICAgIHRvZ2dsZURldGFpbHMsXHJcbiAgfTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB7XHJcbiAgaGFuZGxlQ3JlYXRlTGlzdElucHV0LFxyXG4gIGhhbmRsZUNyZWF0ZVRhc2tJbnB1dCxcclxuICBlZGl0VGFzayxcclxuICB0b2dnbGVEZXRhaWxzLFxyXG59ID0gRXZlbnRIYW5kbGVyKCk7XHJcbiIsImltcG9ydCB7IHJlbmRlckxpc3RFbGVtZW50cyB9IGZyb20gXCIuL0xpc3RSZW5kZXJlclwiO1xyXG5cclxuY29uc3QgTGlzdEhhbmRsZXIgPSAoKSA9PiB7XHJcbiAgY29uc3QgY3JlYXRlRGVmYXVsdExpc3QgPSAoY3VycmVudFByb2plY3QpID0+IHtcclxuICAgIGNvbnN0IGhhYml0TGlzdCA9IGN1cnJlbnRQcm9qZWN0LmNyZWF0ZUxpc3QoXCJIYWJpdHNcIik7XHJcbiAgICBoYWJpdExpc3QuY3JlYXRlVGFzayhcIkNyZWF0ZSB5b3VyIGZpcnN0IHRhc2shXCIpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNoZWNrRm9yTGlzdHMgPSAoY3VycmVudFByb2plY3QpID0+IHtcclxuICAgIGNvbnN0IGN1cnJlbnRMaXN0cyA9IGN1cnJlbnRQcm9qZWN0LmdldExpc3RzKCk7XHJcbiAgICBpZiAoY3VycmVudExpc3RzLmxlbmd0aCkge1xyXG4gICAgICByZW5kZXJMaXN0RWxlbWVudHMoY3VycmVudExpc3RzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNyZWF0ZURlZmF1bHRMaXN0KGN1cnJlbnRQcm9qZWN0KTtcclxuICAgICAgcmVuZGVyTGlzdEVsZW1lbnRzKGN1cnJlbnRQcm9qZWN0LmdldExpc3RzKCkpO1xyXG4gICAgfVxyXG4gIH07XHJcbiAgcmV0dXJuIHsgY2hlY2tGb3JMaXN0cyB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHsgY2hlY2tGb3JMaXN0cyB9ID0gTGlzdEhhbmRsZXIoKTtcclxuIiwiaW1wb3J0IFByb2plY3QgZnJvbSBcIi4vUHJvamVjdC5qc1wiO1xyXG5pbXBvcnQgeyBoYW5kbGVDcmVhdGVMaXN0SW5wdXQgfSBmcm9tIFwiLi9FdmVudEhhbmRsZXIuanNcIjtcclxuaW1wb3J0IHsgY2hlY2tGb3JMaXN0cyB9IGZyb20gXCIuL0xpc3RIYW5kbGVyLmpzXCI7XHJcblxyXG5jb25zdCBjdXJyZW50UHJvamVjdCA9IFByb2plY3QoKTtcclxuXHJcbmNvbnN0IFVzZXJJbnRlcmZhY2UgPSAoKCkgPT4ge1xyXG4gIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsaXN0LWlucHV0XCIpO1xyXG5cclxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xyXG4gICAgY2hlY2tGb3JMaXN0cyhjdXJyZW50UHJvamVjdCk7XHJcblxyXG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcclxuICAgICAgaGFuZGxlQ3JlYXRlTGlzdElucHV0KGUsIGN1cnJlbnRQcm9qZWN0KTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7IGluaXQgfTtcclxufSkoKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFVzZXJJbnRlcmZhY2U7XHJcbiIsImltcG9ydCBMaXN0IGZyb20gXCIuL0xpc3RcIjtcclxuXHJcbmNvbnN0IFByb2plY3QgPSAoKSA9PiB7XHJcbiAgY29uc3QgbGlzdHMgPSBbXTtcclxuXHJcbiAgY29uc3QgZ2V0TGlzdHMgPSAoKSA9PiBsaXN0cztcclxuXHJcbiAgY29uc3QgY3JlYXRlTGlzdCA9ICh0aXRsZSkgPT4ge1xyXG4gICAgbGlzdHMucHVzaChMaXN0KHRpdGxlKSk7XHJcbiAgICByZXR1cm4gbGlzdHNbbGlzdHMubGVuZ3RoIC0gMV07XHJcbiAgfTtcclxuICBjb25zdCBmaW5kTGlzdCA9IChsaXN0SWQpID0+IHtcclxuICAgIGNvbnN0IGxpc3RJbmRleCA9IGxpc3RzLmZpbmRJbmRleCgobGlzdCkgPT4gbGlzdC5pZCA9PT0gbGlzdElkKTtcclxuICAgIHJldHVybiBsaXN0c1tsaXN0SW5kZXhdO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7IGdldExpc3RzLCBjcmVhdGVMaXN0LCBmaW5kTGlzdCB9O1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgUHJvamVjdDtcclxuIiwiaW1wb3J0IFRhc2tNYW5hZ2VyIGZyb20gXCIuL21vZHVsZXMvVGFza01hbmFnZXIuanNcIjtcclxuaW1wb3J0IFVzZXJJbnRlcmZhY2UgZnJvbSBcIi4vbW9kdWxlcy9Vc2VySW50ZXJmYWNlLmpzXCI7XHJcbmltcG9ydCBQcm9qZWN0IGZyb20gXCIuL21vZHVsZXMvUHJvamVjdC5qc1wiO1xyXG5cclxuY29uc3QgVUkgPSBVc2VySW50ZXJmYWNlO1xyXG5VSS5pbml0KCk7XHJcblxyXG4vLyAgIC8vIENyZWF0ZSBsaXN0XHJcblxyXG4vLyAgIC8vIFBhc3MgaW4gYXJyYXkgb2YgZWxlbWVudHMgdG8gYmUgcmVuZGVyZWQgaW4gdGhlIGxpc3QgY29udGFpbmVyXHJcblxyXG4vKiBOb3cgSSB3YW50IHRvIGxpbmsgaXQgdG8gdGhlIFVJXHJcbiAgRm9ybSBJbnB1dCB0byBjcmVhdGUgYSBuZXcgTGlzdFxyXG4gIG5ldyBMaXN0IHdpbGwgY29udGFpbiBhbiBpbnB1dCB0byBjcmVhdGUgYSBuZXcgVGFza1xyXG4qL1xyXG5cclxuLyogVXBkYXRpbmcgVGFza1xyXG4gIEZvcm0gaW5wdXQgaW4gTGlzdFxyXG4gIFN1Ym1pdCBhIG5ldyBUYXNrIHRvIGxpc3RTdG9yYWdlW3hdLmNyZWF0ZVRhc2sodGFza0RldGFpbHMpO1xyXG5cclxuKi9cclxuIl0sIm5hbWVzIjpbInRpdGxlIiwiaWQiLCJjcnlwdG8iLCJyYW5kb21VVUlEIiwic2xpY2UiLCJ0YXNrcyIsInRhc2tNYW5hZ2VyIiwidGFza0xpc3QiLCJnZXRUYXNrQnlJbmRleCIsInRhc2tJZCIsImZpbmRJbmRleCIsInRhc2siLCJnZXRUYXNrQnlJZCIsImZpbmQiLCJjcmVhdGVUYXNrIiwicHVzaCIsImxlbmd0aCIsInVwZGF0ZVRhc2siLCJ1cGRhdGVkRW50cnkiLCJ0YXNrSW5kZXgiLCJyZW1vdmVUYXNrIiwic3BsaWNlIiwiZ2V0VGl0bGUiLCJnZXRJZCIsImdldFRhc2tzIiwiYXBwZW5kQ3VzdG9tRWxlbWVudCIsImNyZWF0ZUN1c3RvbUVsZW1lbnQiLCJvcHRpb25zIiwidGFnTmFtZSIsImNsYXNzTGlzdCIsInRleHRDb250ZW50IiwiYXR0cmlidXRlcyIsImVsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJhZGQiLCJBcnJheSIsImlzQXJyYXkiLCJhdHRyIiwidmFsdWUiLCJzZXRBdHRyaWJ1dGUiLCJ0YXJnZXQiLCJ0YXJnZXRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImFwcGVuZENoaWxkIiwiY3VzdG9tRWxlbWVudEhlbHBlciIsImNyZWF0ZVRhc2tFbGVtZW50cyIsInJlbmRlclRhc2tFbGVtZW50cyIsInJlbmRlckV4cGFuZGVkVGFzayIsImN1cnJlbnRMaXN0IiwibWFwIiwiZGl2IiwiY2xhc3NOYW1lIiwiZGF0YXNldCIsInAiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImVkaXRUYXNrIiwidG9nZ2xlRGV0YWlscyIsInByZXBlbmQiLCJleHBhbmRlZFRhc2siLCJkZXNjcmlwdGlvbiIsImR1ZURhdGUiLCJkaWZmaWN1bHR5IiwiZnJhZ21lbnQiLCJjcmVhdGVEb2N1bWVudEZyYWdtZW50IiwiZXhwYW5kZWREaXYiLCJhcHBlbmQiLCJfX2NyZWF0ZUV4cGFuZGVkVGFzayIsInJlbmRlckxpc3RFbGVtZW50cyIsImxpc3RzIiwiZm9yRWFjaCIsImxpc3QiLCJsaXN0SWQiLCJhcHBlbmRMaXN0Q29udGFpbmVyIiwibGlzdEVsZW1lbnQiLCJ0YXNrRm9ybSIsInRhc2tJbnB1dCIsImhhbmRsZUNyZWF0ZVRhc2tJbnB1dCIsImNyZWF0ZVRhc2tGb3JtIiwiYXBwZW5kTGlzdEFuZFRpdGxlRWxlbWVudHMiLCJhcHBlbmRUYXNrQ29udGFpbmVyIiwidGFza0NvbnRhaW5lciIsInRhc2tFbGVtZW50cyIsImFwcGVuZFRhc2tFbGVtZW50cyIsImhhbmRsZUNyZWF0ZUxpc3RJbnB1dCIsImN1cnJlbnRQcm9qZWN0Iiwia2V5IiwicHJldmVudERlZmF1bHQiLCJuZXdMaXN0IiwiY3JlYXRlTGlzdCIsIm5ld1Rhc2siLCJ0YXNrRWxlbWVudCIsImVsIiwicHJldmlvdXMiLCJjbG9uZU5vZGUiLCJpbnB1dCIsImN1cnJlbnRUYXNrIiwicmVwbGFjZVdpdGgiLCJibHVyIiwib25jZSIsImZvY3VzIiwiY2xvc2VzdCIsImV4cGFuZGVkRGV0YWlscyIsInRvZ2dsZSIsInJlbW92ZSIsImNoZWNrRm9yTGlzdHMiLCJjdXJyZW50TGlzdHMiLCJnZXRMaXN0cyIsImNyZWF0ZURlZmF1bHRMaXN0IiwiZmluZExpc3QiLCJsaXN0SW5kZXgiLCJpbml0Il0sInNvdXJjZVJvb3QiOiIifQ==